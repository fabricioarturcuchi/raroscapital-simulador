<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Raros Capital - Simulador de Consórcio</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Roboto', sans-serif;
    margin: 0; padding: 20px;
    background: #f0f3f7;
    color: #1d3557;
  }
  .container {
    max-width: 960px;
    margin: auto;
    background: #fff;
    border-radius: 10px;
    padding: 25px 30px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    display: flex;
    gap: 40px;
    flex-wrap: wrap;
  }
  .left, .right {
    flex: 1 1 400px;
    min-width: 300px;
  }
  .logo {
    max-width: 180px;
    margin-bottom: 20px;
    display: block;
  }
  h1 {
    margin: 0 0 10px;
    font-weight: 700;
    font-size: 28px;
    color: #1d3557;
  }
  p.subtitle {
    color: #555;
    font-size: 16px;
    margin-bottom: 25px;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    margin-top: 15px;
    color: #2a3a54;
  }
  input, select {
    width: 100%;
    padding: 12px 15px;
    font-size: 16px;
    border-radius: 6px;
    border: 1.5px solid #ccc;
    transition: border-color 0.3s ease;
  }
  input:focus, select:focus {
    outline: none;
    border-color: #457b9d;
  }
  input[readonly] {
    background: #f5f7fa;
    cursor: not-allowed;
  }
  button {
    margin-top: 25px;
    width: 100%;
    background-color: #1d3557;
    color: white;
    font-weight: 700;
    font-size: 18px;
    padding: 15px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.25s ease;
  }
  button:hover {
    background-color: #457b9d;
  }
  #resultado {
    margin-top: 30px;
    padding: 25px;
    background: #eaf4f9;
    border-radius: 10px;
    box-shadow: inset 0 0 5px rgba(0,0,0,0.05);
    color: #1d3557;
  }
  #resultado h3 {
    margin-top: 0;
    font-weight: 700;
    font-size: 22px;
    margin-bottom: 15px;
  }
  #resultado p {
    font-size: 16px;
    margin: 6px 0;
  }
  #resultado p span.value {
    font-weight: 700;
    font-size: 20px;
    color: #e63946;
  }
  .thanks {
    margin-top: 30px;
    font-weight: 600;
    font-size: 18px;
    color: #2a3a54;
    text-align: center;
  }
  /* Flex align labels and inputs */
  form label {
    font-size: 14px;
  }
  /* PDF button */
  #btnPdf {
    margin-top: 15px;
    background-color: #e63946;
  }
  #btnPdf:hover {
    background-color: #a62a32;
  }
  @media(max-width: 720px) {
    .container {
      flex-direction: column;
    }
  }
</style>
</head>
<body>

<div class="container" id="contentToPrint">
  <div class="left">
    <img src="https://i.postimg.cc/wMPWky1K/Sem-t-tulo-removebg-preview.png" alt="Raros Capital Logo" class="logo" />
    <h1>Raros Capital</h1>
    <p class="subtitle">Descubra qual consórcio combina com você. Preencha seus dados para simular.</p>

    <form id="lead-form" onsubmit="return handleFormSubmit(event)" novalidate>
      <label for="name">Nome completo *</label>
      <input type="text" id="name" name="name" placeholder="Seu nome completo" required>

      <label for="email">E-mail *</label>
      <input type="email" id="email" name="email" placeholder="Seu e-mail" required>

      <label for="phone">WhatsApp (com DDD) *</label>
      <input type="tel" id="phone" name="phone" placeholder="(99) 99999-9999" required maxlength="15" oninput="mascaraTelefone(this)" >

      <label for="tipo">Tipo de Consórcio *</label>
      <select id="tipo" name="tipo" onchange="atualizarParcelas()">
        <option value="imovel">Imóvel</option>
        <option value="auto">Automóvel</option>
      </select>

      <label for="valor">Valor total (R$) *</label> 
      <input type="text" id="valor" oninput="mascaraMoeda(this)" required autocomplete="off" />

      <label for="parcelas">Parcelas</label>
      <input type="number" id="parcelas" name="parcelas" readonly>

      <button type="submit">Gerar Simulação</button>
    </form>
  </div>

  <div class="right">
    <div id="resultado" style="display:none;">
      <h3>Resultado da Simulação</h3>
      <p><strong>Nome:</strong> <span id="resNome"></span></p>
      <p><strong>E-mail:</strong> <span id="resEmail"></span></p>
      <p><strong>WhatsApp:</strong> <span id="resPhone"></span></p>
      <hr />
      <p><strong>Tipo de consórcio:</strong> <span id="resTipo"></span></p>
      <p><strong>Valor solicitado:</strong> <span class="value" id="resValor"></span></p>
      <p><strong>Parcelas:</strong> <span id="resParcelas"></span></p>
      <p><strong>Taxa administrativa:</strong> <span id="resTaxa"></span></p>
      <p><strong>Valor total com taxa:</strong> <span class="value" id="resValorTotal"></span></p>
      <p><strong>Valor da parcela mensal:</strong> <span class="value" id="resParcela"></span></p>
      <div class="thanks">Obrigado por usar nosso simulador!</div>
      <button id="btnPdf" onclick="gerarPDF()">Baixar PDF</button>
    </div>
  </div>
</div>

<!-- jsPDF CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
  const parcelasMap = { imovel: 220, auto: 84 };
  const taxaMap = { imovel: 0.22, auto: 0.16 };
  const minMaxValor = {
    imovel: { min: 200000, max: 500000 },
    auto: { min: 65000, max: 130000 }
  };

  function atualizarParcelas() {
    const tipo = document.getElementById('tipo').value;
    document.getElementById('parcelas').value = parcelasMap[tipo];
  }

  // Máscara moeda pt-BR (R$xxx.xxx,xx)
  function mascaraMoeda(input) {
    let valor = input.value;

    // Remove tudo exceto números
    valor = valor.replace(/\D/g, '');

    // Formata o número para moeda BRL com separadores milhar e decimal
    valor = (parseInt(valor, 10) || 0).toString();

    // Limpa zeros à esquerda para evitar confusão
    valor = valor.replace(/^0+/, '');

    // Se vazio, volta vazio
    if(valor === '') {
      input.value = '';
      return;
    }

    // Coloca vírgula para os 2 últimos dígitos (centavos)
    if(valor.length === 1) {
      valor = '0,0' + valor;
    } else if(valor.length === 2) {
      valor = '0,' + valor;
    } else {
      let intPart = valor.slice(0, -2);
      let decPart = valor.slice(-2);
      // Adiciona pontos como separador de milhar
      intPart = intPart.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
      valor = intPart + ',' + decPart;
    }
    input.value = 'R$ ' + valor;
  }

  // Máscara telefone (99) 99999-9999
  function mascaraTelefone(input) {
    let v = input.value.replace(/\D/g, '');
    if (v.length > 11) v = v.slice(0,11);
    if (v.length > 6) {
      input.value = `(${v.slice(0,2)}) ${v.slice(2,7)}-${v.slice(7)}`;
    } else if (v.length > 2) {
      input.value = `(${v.slice(0,2)}) ${v.slice(2)}`;
    } else if (v.length > 0) {
      input.value = `(${v}`;
    }
  }

  // Form submit handler
  function handleFormSubmit(event) {
    event.preventDefault();

    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const tipo = document.getElementById('tipo').value;
    const valorRaw = document.getElementById('valor').value.trim();

    // Validações básicas
    if (!name || !email || !phone || !valorRaw) {
      alert('Por favor, preencha todos os campos obrigatórios.');
      return false;
    }

    // Extrai número do valor
    let valorNum = valorRaw.replace(/[R$\.\s]/g, '').replace(',', '.');
    valorNum = parseFloat(valorNum);
    if (isNaN(valorNum)) {
      alert('Informe um valor válido.');
      return false;
    }

    const { min, max } = minMaxValor[tipo];
    if (valorNum < min || valorNum > max) {
      alert(`O valor para consórcio de ${tipo === 'imovel' ? 'Imóvel' : 'Automóvel'} deve ser entre R$ ${min.toLocaleString('pt-BR')} e R$ ${max.toLocaleString('pt-BR')}.`);
      return false;
    }

    const parcelas = parcelasMap[tipo];
    const taxa = taxaMap[tipo];

    // Calcula valor total com taxa
    const valorTotal = valorNum * (1 + taxa);

    // Calcula parcela mensal
    const parcelaMensal = valorTotal / parcelas;

    // Exibe resultado
    document.getElementById('resNome').textContent = name;
    document.getElementById('resEmail').textContent = email;
    document.getElementById('resPhone').textContent = phone;
    document.getElementById('resTipo').textContent = tipo === 'imovel' ? 'Imóvel' : 'Automóvel';
    document.getElementById('resValor').textContent = valorNum.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    document.getElementById('resParcelas').textContent = parcelas;
    document.getElementById('resTaxa').textContent = (taxa * 100).toFixed(2) + '%';
    document.getElementById('resValorTotal').textContent = valorTotal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    document.getElementById('resParcela').textContent = parcelaMensal.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

    document.getElementById('resultado').style.display = 'block';

    // Enviar lead via fetch sem mensagem para o usuário
    enviarLead({name, email, phone, tipo, valor: valorNum});

    return false;
  }

  // Envia dados para API de lead (exemplo)
  function enviarLead(data) {
    // Exemplo: substituir URL pelo endpoint real
    const url = '65709bc8-db25-43ad-9d94-89fe01b115e7'; 

    fetch(url, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    }).catch(() => {
      // Não exibir mensagens ao usuário, falha silenciosa
    });
  }

  // Inicializa parcelas no carregamento
  window.onload = () => {
    atualizarParcelas();
  };

  // Gera PDF usando jsPDF com layout bonito e frase motivacional
  async function gerarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const imgUrl = 'https://i.postimg.cc/wMPWky1K/Sem-t-tulo-removebg-preview.png';
    const img = new Image();
    img.crossOrigin = 'anonymous';
    img.src = imgUrl;

    img.onload = function () {
      doc.setFont('helvetica', 'bold');
      doc.setTextColor('#1d3557');
      doc.setFontSize(22);
      doc.text('Raros Capital', 70, 20);

      doc.addImage(img, 'PNG', 15, 10, 40, 20);

      doc.setDrawColor('#e63946');
      doc.setLineWidth(1.5);
      doc.line(15, 30, 195, 30);

      doc.setFontSize(18);
      doc.setTextColor('#e63946');
      doc.text('Resultado da Simulação', 15, 40);

      doc.setFontSize(12);
      doc.setTextColor('#000');
      let y = 50;
      const lineHeight = 10;

      function addLine(label, value) {
        doc.setFont(undefined, 'bold');
        doc.text(label, 15, y);
        doc.setFont(undefined, 'normal');
        doc.text(value, 80, y);
        y += lineHeight;
      }

      addLine('Nome:', document.getElementById('resNome').textContent);
      addLine('E-mail:', document.getElementById('resEmail').textContent);
      addLine('WhatsApp:', document.getElementById('resPhone').textContent);
      y += 5;
      addLine('Tipo de consórcio:', document.getElementById('resTipo').textContent);
      addLine('Valor solicitado:', document.getElementById('resValor').textContent);
      addLine('Parcelas:', document.getElementById('resParcelas').textContent);
      addLine('Taxa administrativa:', document.getElementById('resTaxa').textContent);
      addLine('Valor total com taxa:', document.getElementById('resValorTotal').textContent);
      addLine('Valor da parcela mensal:', document.getElementById('resParcela').textContent);

      y += 15;
      doc.setFontSize(14);
      doc.setTextColor('#457b9d');
      doc.setFont(undefined, 'italic');
      doc.text('Invista no seu sonho hoje e conquiste o futuro que merece!', 15, y);

      doc.save('Simulacao_Consorcio_RarosCapital.pdf');
    };
  }
</script>

</body>
</html>
